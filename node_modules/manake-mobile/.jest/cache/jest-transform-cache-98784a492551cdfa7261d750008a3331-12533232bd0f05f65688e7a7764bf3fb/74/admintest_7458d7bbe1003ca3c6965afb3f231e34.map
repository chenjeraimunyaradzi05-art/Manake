{"version":3,"names":["_getJestObj","mock","getAuthToken","_interopRequireDefault","require","_asyncToGenerator2","_admin","_require","jest","mockFetch","fn","global","fetch","describe","beforeEach","mockClear","it","default","mockStats","users","total","newThisMonth","stories","pending","donations","totalAmount","totalCount","messages","unread","mockResolvedValueOnce","ok","json","_json","apply","arguments","stats","getDashboardStats","expect","toHaveBeenCalledWith","stringContaining","objectContaining","headers","Authorization","toEqual","mockResponse","data","_id","title","status","pagination","page","limit","pages","_json2","result","getPendingStories","any","Object","toHaveLength","message","_json3","approveStory","method","toBe","_json4","rejectStory","body","JSON","stringify","reason","name","role","_json5","getUsers","search","stringMatching","_json6","deleteUser","_json7","rejects","toThrow"],"sources":["admin.test.ts"],"sourcesContent":["/**\r\n * Admin Service Tests\r\n */\r\n\r\nimport { getDashboardStats, getPendingStories, approveStory, rejectStory, getUsers, deleteUser } from '../admin';\r\n\r\n// Mock fetch\r\nconst mockFetch = jest.fn();\r\nglobal.fetch = mockFetch;\r\n\r\n// Mock getAuthToken\r\njest.mock('../api', () => ({\r\n  getAuthToken: () => 'mock-admin-token',\r\n}));\r\n\r\ndescribe('Admin Service', () => {\r\n  beforeEach(() => {\r\n    mockFetch.mockClear();\r\n  });\r\n\r\n  describe('getDashboardStats', () => {\r\n    it('should fetch dashboard statistics', async () => {\r\n      const mockStats = {\r\n        users: { total: 100, newThisMonth: 10 },\r\n        stories: { total: 50, pending: 5 },\r\n        donations: { totalAmount: 5000, totalCount: 25 },\r\n        messages: { total: 200, unread: 15 },\r\n      };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => mockStats,\r\n      });\r\n\r\n      const stats = await getDashboardStats();\r\n\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        expect.stringContaining('/v1/admin/stats'),\r\n        expect.objectContaining({\r\n          headers: expect.objectContaining({\r\n            Authorization: 'Bearer mock-admin-token',\r\n          }),\r\n        })\r\n      );\r\n      expect(stats).toEqual(mockStats);\r\n    });\r\n  });\r\n\r\n  describe('getPendingStories', () => {\r\n    it('should fetch pending stories with pagination', async () => {\r\n      const mockResponse = {\r\n        data: [{ _id: '1', title: 'Test Story', status: 'pending' }],\r\n        pagination: { page: 1, limit: 20, total: 1, pages: 1 },\r\n      };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => mockResponse,\r\n      });\r\n\r\n      const result = await getPendingStories(1, 20);\r\n\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        expect.stringContaining('/v1/admin/stories/pending'),\r\n        expect.any(Object)\r\n      );\r\n      expect(result.data).toHaveLength(1);\r\n    });\r\n  });\r\n\r\n  describe('approveStory', () => {\r\n    it('should approve a story', async () => {\r\n      const mockResponse = {\r\n        message: 'Story approved',\r\n        data: { _id: '123', status: 'published' },\r\n      };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => mockResponse,\r\n      });\r\n\r\n      const result = await approveStory('123');\r\n\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        expect.stringContaining('/v1/admin/stories/123/approve'),\r\n        expect.objectContaining({ method: 'PATCH' })\r\n      );\r\n      expect(result.message).toBe('Story approved');\r\n    });\r\n  });\r\n\r\n  describe('rejectStory', () => {\r\n    it('should reject a story with reason', async () => {\r\n      const mockResponse = {\r\n        message: 'Story rejected',\r\n        data: { _id: '123', status: 'rejected' },\r\n      };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => mockResponse,\r\n      });\r\n\r\n      const result = await rejectStory('123', 'Content not appropriate');\r\n\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        expect.stringContaining('/v1/admin/stories/123/reject'),\r\n        expect.objectContaining({\r\n          method: 'PATCH',\r\n          body: JSON.stringify({ reason: 'Content not appropriate' }),\r\n        })\r\n      );\r\n      expect(result.message).toBe('Story rejected');\r\n    });\r\n  });\r\n\r\n  describe('getUsers', () => {\r\n    it('should fetch users with filters', async () => {\r\n      const mockResponse = {\r\n        data: [{ _id: '1', name: 'Test User', role: 'user' }],\r\n        pagination: { page: 1, limit: 20, total: 1, pages: 1 },\r\n      };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => mockResponse,\r\n      });\r\n\r\n      const result = await getUsers(1, 20, { role: 'admin', search: 'test' });\r\n\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        expect.stringMatching(/\\/v1\\/admin\\/users\\?.*role=admin.*search=test/),\r\n        expect.any(Object)\r\n      );\r\n      expect(result.data).toHaveLength(1);\r\n    });\r\n  });\r\n\r\n  describe('deleteUser', () => {\r\n    it('should delete a user', async () => {\r\n      const mockResponse = { message: 'User deleted' };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => mockResponse,\r\n      });\r\n\r\n      const result = await deleteUser('123');\r\n\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        expect.stringContaining('/v1/admin/users/123'),\r\n        expect.objectContaining({ method: 'DELETE' })\r\n      );\r\n      expect(result.message).toBe('User deleted');\r\n    });\r\n  });\r\n\r\n  describe('error handling', () => {\r\n    it('should throw on API error', async () => {\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: false,\r\n        status: 403,\r\n        json: async () => ({ message: 'Forbidden' }),\r\n      });\r\n\r\n      await expect(getDashboardStats()).rejects.toThrow('Forbidden');\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}