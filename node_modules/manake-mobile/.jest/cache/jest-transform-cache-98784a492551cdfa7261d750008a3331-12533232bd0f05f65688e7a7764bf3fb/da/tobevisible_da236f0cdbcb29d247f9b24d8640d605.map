{"version":3,"names":["_jestMatcherUtils","require","_reactNative","_accessiblity","_componentTree","_hostComponentNames","_utils","toBeVisible","element","_this","isNot","checkHostElement","pass","isElementVisible","message","is","matcherHint","formatElement","join","accessibilityCache","cache","WeakMap","isHiddenFromAccessibility","isHiddenForStyles","isHostModal","props","visible","hostParent","getHostParent","_element$props$style","style","_reactNative$StyleShe","StyleSheet","flatten","display","opacity"],"sources":["../../src/matchers/to-be-visible.tsx"],"sourcesContent":["import type { ReactTestInstance } from 'react-test-renderer';\nimport { matcherHint } from 'jest-matcher-utils';\nimport { StyleSheet } from 'react-native';\nimport { isHiddenFromAccessibility } from '../helpers/accessiblity';\nimport { getHostParent } from '../helpers/component-tree';\nimport { isHostModal } from '../helpers/host-component-names';\nimport { checkHostElement, formatElement } from './utils';\n\nexport function toBeVisible(\n  this: jest.MatcherContext,\n  element: ReactTestInstance\n) {\n  if (element !== null || !this.isNot) {\n    checkHostElement(element, toBeVisible, this);\n  }\n\n  return {\n    pass: isElementVisible(element),\n    message: () => {\n      const is = this.isNot ? 'is' : 'is not';\n      return [\n        matcherHint(`${this.isNot ? '.not' : ''}.toBeVisible`, 'element', ''),\n        '',\n        `Received element ${is} visible:`,\n        formatElement(element),\n      ].join('\\n');\n    },\n  };\n}\n\nfunction isElementVisible(\n  element: ReactTestInstance,\n  accessibilityCache?: WeakMap<ReactTestInstance, boolean>\n): boolean {\n  // Use cache to speed up repeated searches by `isHiddenFromAccessibility`.\n  const cache = accessibilityCache ?? new WeakMap<ReactTestInstance, boolean>();\n  if (isHiddenFromAccessibility(element, { cache })) {\n    return false;\n  }\n\n  if (isHiddenForStyles(element)) {\n    return false;\n  }\n\n  // Note: this seems to be a bug in React Native.\n  // PR with fix: https://github.com/facebook/react-native/pull/39157\n  if (isHostModal(element) && element.props.visible === false) {\n    return false;\n  }\n\n  const hostParent = getHostParent(element);\n  if (hostParent === null) {\n    return true;\n  }\n\n  return isElementVisible(hostParent, cache);\n}\n\nfunction isHiddenForStyles(element: ReactTestInstance) {\n  const style = element.props.style ?? {};\n  const { display, opacity } = StyleSheet.flatten(style);\n  return display === 'none' || opacity === 0;\n}\n"],"mappings":";;;;;;AACA,IAAAA,iBAAA,GAAAC,OAAA;AACA,IAAAC,YAAA,GAAAD,OAAA;AACA,IAAAE,aAAA,GAAAF,OAAA;AACA,IAAAG,cAAA,GAAAH,OAAA;AACA,IAAAI,mBAAA,GAAAJ,OAAA;AACA,IAAAK,MAAA,GAAAL,OAAA;AAEO,SAASM,WAAWA,CAEzBC,OAA0B,EAC1B;EAAA,IAAAC,KAAA;EACA,IAAID,OAAO,KAAK,IAAI,IAAI,CAAC,IAAI,CAACE,KAAK,EAAE;IACnC,IAAAJ,MAAA,CAAAK,gBAAgB,EAACH,OAAO,EAAED,WAAW,EAAE,IAAI,CAAC;EAC9C;EAEA,OAAO;IACLK,IAAI,EAAEC,gBAAgB,CAACL,OAAO,CAAC;IAC/BM,OAAO,EAAE,SAATA,OAAOA,CAAA,EAAQ;MACb,IAAMC,EAAE,GAAGN,KAAI,CAACC,KAAK,GAAG,IAAI,GAAG,QAAQ;MACvC,OAAO,CACL,IAAAV,iBAAA,CAAAgB,WAAW,EAAE,GAAEP,KAAI,CAACC,KAAK,GAAG,MAAM,GAAG,EAAG,cAAa,EAAE,SAAS,EAAE,EAAE,CAAC,EACrE,EAAE,EACD,oBAAmBK,EAAG,WAAU,EACjC,IAAAT,MAAA,CAAAW,aAAa,EAACT,OAAO,CAAC,CACvB,CAACU,IAAI,CAAC,IAAI,CAAC;IACd;EACF,CAAC;AACH;AAEA,SAASL,gBAAgBA,CACvBL,OAA0B,EAC1BW,kBAAwD,EAC/C;EAET,IAAMC,KAAK,GAAGD,kBAAkB,WAAlBA,kBAAkB,GAAI,IAAIE,OAAO,CAA6B,CAAC;EAC7E,IAAI,IAAAlB,aAAA,CAAAmB,yBAAyB,EAACd,OAAO,EAAE;IAAEY,KAAA,EAAAA;EAAM,CAAC,CAAC,EAAE;IACjD,OAAO,KAAK;EACd;EAEA,IAAIG,iBAAiB,CAACf,OAAO,CAAC,EAAE;IAC9B,OAAO,KAAK;EACd;EAIA,IAAI,IAAAH,mBAAA,CAAAmB,WAAW,EAAChB,OAAO,CAAC,IAAIA,OAAO,CAACiB,KAAK,CAACC,OAAO,KAAK,KAAK,EAAE;IAC3D,OAAO,KAAK;EACd;EAEA,IAAMC,UAAU,GAAG,IAAAvB,cAAA,CAAAwB,aAAa,EAACpB,OAAO,CAAC;EACzC,IAAImB,UAAU,KAAK,IAAI,EAAE;IACvB,OAAO,IAAI;EACb;EAEA,OAAOd,gBAAgB,CAACc,UAAU,EAAEP,KAAK,CAAC;AAC5C;AAEA,SAASG,iBAAiBA,CAACf,OAA0B,EAAE;EAAA,IAAAqB,oBAAA;EACrD,IAAMC,KAAK,IAAAD,oBAAA,GAAGrB,OAAO,CAACiB,KAAK,CAACK,KAAK,YAAAD,oBAAA,GAAI,CAAC,CAAC;EACvC,IAAAE,qBAAA,GAA6B7B,YAAA,CAAA8B,UAAU,CAACC,OAAO,CAACH,KAAK,CAAC;IAA9CI,OAAO,GAAAH,qBAAA,CAAPG,OAAO;IAAEC,OAAA,GAAAJ,qBAAA,CAAAI,OAAA;EACjB,OAAOD,OAAO,KAAK,MAAM,IAAIC,OAAO,KAAK,CAAC;AAC5C","ignoreList":[]}